<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard de Controle - Prefeitura de Guarulhos</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>
</head>
<body>
    <div class="wrapper">
        <!-- Sidebar Navigation -->
        <aside class="sidebar">
            <div class="sidebar-brand">
                <div class="brand-icon">üèõÔ∏è</div>
                <div class="brand-text">
                    <h2>Guarulhos</h2>
                    <p>Controle de Pagamentos</p>
                </div>
            </div>
            
            <nav class="sidebar-nav">
                <div class="nav-item active">
                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <polyline points="23 6 13.5 15.5 8.5 10.5 1 17"></polyline>
                        <polyline points="17 6 23 6 23 12"></polyline>
                    </svg>
                    <span>Vis√£o Geral</span>
                </div>
            </nav>

            <div class="sidebar-footer">
                <div class="status-indicator">
                    <span id="status-dot" class="dot"></span>
                    <span id="status-label">Conectando...</span>
                </div>
                <p id="last-sync" class="text-xs">√öltima atualiza√ß√£o: --:--</p>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Header -->
            <header class="header">
                <div class="header-left">
                    <h1>Controle de Pagamentos</h1>
                    <p class="subtitle">Gest√£o de Contratos e Gastos 2025</p>
                </div>
                <div class="header-right">
                    <div style="display: flex; align-items: center; gap: 15px;">
                        <span id="user-name" style="font-size: 14px; font-weight: 600; color: var(--primary);"></span>
                        <button onclick="logout()" style="padding: 8px 16px; background: var(--accent); color: white; border: none; border-radius: 20px; cursor: pointer; font-size: 13px; font-weight: 700;">SAIR</button>
                    </div>
                    <div class="search-box">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <input type="text" id="search-input" placeholder="Buscar empresa ou contrato...">
                    </div>
                </div>
            </header>

            <!-- Statistics Cards -->
            <section class="stats-grid">
                <div class="stat-card">
                    <div class="stat-header">
                        <div>
                            <h3>Total Contratado</h3>
                            <p class="stat-value" id="total-contracted">R$ 0,00</p>
                        </div>
                        <div class="stat-icon" style="background: rgba(0, 74, 153, 0.1); color: var(--primary);">üí∞</div>
                    </div>
                </div>

                <div class="stat-card" style="border-left-color: var(--accent);">
                    <div class="stat-header">
                        <div>
                            <h3>Total Gasto</h3>
                            <p class="stat-value" id="total-spent" style="color: var(--accent);">R$ 0,00</p>
                        </div>
                        <div class="stat-icon" style="background: rgba(206, 17, 38, 0.1); color: var(--accent);">üí∏</div>
                    </div>
                </div>

                <div class="stat-card" style="border-left-color: var(--secondary);">
                    <div class="stat-header">
                        <div>
                            <h3>Utiliza√ß√£o M√©dia</h3>
                            <p class="stat-value" id="average-utilization">0%</p>
                        </div>
                        <div class="stat-icon" style="background: rgba(252, 209, 22, 0.1); color: #b89600;">üìà</div>
                    </div>
                </div>

                <div class="stat-card">
                    <div class="stat-header">
                        <div>
                            <h3>Empresas Ativas</h3>
                            <p class="stat-value" id="companies-count">0</p>
                        </div>
                        <div class="stat-icon" style="background: rgba(40, 167, 69, 0.1); color: #28a745;">üè¢</div>
                    </div>
                </div>
            </section>

            <!-- Companies Table -->
            <section class="table-container">
                <div class="table-header">
                    <h2>Monitoramento de Contratos</h2>
                    <span class="badge" id="companies-badge">0 registros</span>
                </div>

                <div class="table-wrapper">
                    <div class="companies-list" id="companies-list">
                        <div class="loading-state">
                            <div class="loading-spinner"></div>
                            <span>Acessando base de dados...</span>
                        </div>
                    </div>
                </div>

                <div class="table-footer">
                    <p id="table-info">Sincronizado com o servidor da Prefeitura</p>
                </div>
            </section>
        </main>
    </div>

    <!-- Modal de Detalhes -->
    <div id="detail-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-company-name"></h2>
                <button class="modal-close" onclick="closeModal()">&times;</button>
            </div>
            
            <!-- Abas -->
            <div class="modal-tabs">
                <button class="tab-button active" onclick="switchTab('details')">Detalhes</button>
                <button class="tab-button" onclick="switchTab('edit')">Editar</button>
                <button class="tab-button" onclick="switchTab('expenses')">Lan√ßamentos</button>
            </div>

            <div class="modal-body">
                <!-- Aba: Detalhes -->
                <div id="tab-details" class="tab-content active">
                    <div class="detail-grid">
                        <div class="detail-item">
                            <span class="detail-label">C√≥digo</span>
                            <span class="detail-value" id="modal-code"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Valor Total do Contrato</span>
                            <span class="detail-value highlight" id="modal-contract"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Valor Gasto</span>
                            <span class="detail-value" id="modal-spent"></span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">Valor Dispon√≠vel</span>
                            <span class="detail-value available" id="modal-available"></span>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h3>An√°lise de Utiliza√ß√£o</h3>
                        <div class="progress-section">
                            <div class="progress-info">
                                <span class="progress-label">Percentual Utilizado</span>
                                <span class="progress-percentage" id="modal-percentage">0%</span>
                            </div>
                            <div class="progress-bar-large">
                                <div class="progress-fill" id="modal-progress" style="width: 0%"></div>
                            </div>
                        </div>
                    </div>

                    <div class="detail-section">
                        <h3>Status</h3>
                        <div class="status-badge" id="modal-status"></div>
                    </div>
                </div>

                <!-- Aba: Editar -->
                <div id="tab-edit" class="tab-content">
                    <form id="edit-form" onsubmit="saveAdjustment(event)">
                        <div class="form-group">
                            <label for="edit-contract">Valor Total do Contrato</label>
                            <input type="number" id="edit-contract" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-spent">Valor Gasto</label>
                            <input type="number" id="edit-spent" step="0.01" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-reason">Motivo da Altera√ß√£o</label>
                            <textarea id="edit-reason" rows="3"></textarea>
                        </div>
                        <button type="submit" class="btn-primary">Salvar Altera√ß√µes</button>
                    </form>
                </div>

                <!-- Aba: Lan√ßamentos -->
                <div id="tab-expenses" class="tab-content">
                    <div class="expenses-section">
                        <h3>Novo Lan√ßamento</h3>
                        <form id="expense-form" onsubmit="addExpense(event)">
                            <div class="form-group">
                                <label for="expense-description">Descri√ß√£o</label>
                                <input type="text" id="expense-description" required>
                            </div>
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="expense-amount">Valor</label>
                                    <input type="number" id="expense-amount" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label for="expense-date">Data</label>
                                    <input type="date" id="expense-date" required>
                                </div>
                            </div>
                            <div class="form-group">
                                <label for="expense-category">Categoria</label>
                                <select id="expense-category">
                                    <option value="">Selecione...</option>
                                    <option value="Servi√ßo">Servi√ßo</option>
                                    <option value="Material">Material</option>
                                    <option value="Consultoria">Consultoria</option>
                                    <option value="Manuten√ß√£o">Manuten√ß√£o</option>
                                    <option value="Outro">Outro</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label for="expense-notes">Observa√ß√µes</label>
                                <textarea id="expense-notes" rows="2"></textarea>
                            </div>
                            <button type="submit" class="btn-primary">Adicionar Lan√ßamento</button>
                        </form>

                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 30px;">
                            <h3>Hist√≥rico de Lan√ßamentos</h3>
                            <button type="button" class="btn-secondary" onclick="downloadExpenses()">üì• Baixar Relat√≥rio</button>
                        </div>
                        <div id="expenses-list" class="expenses-list">
                            <p>Carregando lan√ßamentos...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="{{ url_for('static', filename='script.js') }}"></script>
</body>
</html>
